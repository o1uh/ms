2025-05-29 22:54:00,349 - ServerApp - INFO - Запуск серверного приложения...
2025-05-29 22:54:00,349 - ServerApp - INFO - Сервер запущен и слушает на 127.0.0.1:65432
2025-05-29 22:54:00,350 - ServerApp - INFO - Для остановки сервера нажмите Ctrl+C в этой консоли.
2025-05-29 22:54:04,427 - ServerApp - INFO - Новое подключение от ('127.0.0.1', 53029)
2025-05-29 22:54:04,447 - ServerApp - INFO - Успешное подключение к базе данных PostgreSQL.
2025-05-29 22:54:09,019 - ServerApp - DEBUG - Получено от ('127.0.0.1', 53029) (аутентификация): {"type": "login", "payload": {"username": "1111", "password": "1111"}}
2025-05-29 22:54:09,182 - ServerApp - INFO - Клиент ('127.0.0.1', 53029) аутентифицирован как 1111 (ID: 1)
2025-05-29 22:54:09,182 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:54:09,186 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:54:09,186 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:54:09,186 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:54:09,186 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:54:15,833 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "initiate_direct_chat", "payload": {"target_username": "2233"}}
2025-05-29 22:54:17,054 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:54:17,055 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:54:17,055 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:54:19,881 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "initiate_direct_chat", "payload": {"target_username": "2222"}}
2025-05-29 22:54:19,882 - ServerApp - DEBUG - Найден существующий direct чат ID: 1 для пользователей 1 и 2
2025-05-29 22:54:19,882 - ServerApp - INFO - Чат между 1111 (ID:1) и 2222 (ID:2) инициирован/найден. Chat ID: 1
2025-05-29 22:54:19,884 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_history", "payload": {"chat_id": 1}}
2025-05-29 22:54:19,884 - ServerApp - INFO - User_id 1 запросил историю для чата ID 1.
2025-05-29 22:54:19,885 - ServerApp - DEBUG - Извлечено 25 сообщений для chat_id: 1
2025-05-29 22:54:21,980 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:54:21,980 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:54:21,981 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:54:29,130 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "create_group_request", "payload": {"group_name": "123", "member_usernames": ["1223"]}}
2025-05-29 22:54:29,130 - ServerApp - WARNING - При создании группы '123' не найден пользователь '1223'.
2025-05-29 22:54:52,035 - ServerApp - INFO - Новое подключение от ('127.0.0.1', 53031)
2025-05-29 22:54:52,051 - ServerApp - INFO - Успешное подключение к базе данных PostgreSQL.
2025-05-29 22:54:54,755 - ServerApp - DEBUG - Получено от ('127.0.0.1', 53031) (аутентификация): {"type": "login", "payload": {"username": "2222", "password": "2222"}}
2025-05-29 22:54:54,917 - ServerApp - INFO - Клиент ('127.0.0.1', 53031) аутентифицирован как 2222 (ID: 2)
2025-05-29 22:54:54,917 - ServerApp - INFO - Пользователь ID 2 запросил список чатов.
2025-05-29 22:54:54,920 - ServerApp - DEBUG - Для user_id 2 найдено 3 чатов.
2025-05-29 22:54:54,921 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:54:54,921 - ServerApp - INFO - Пользователь ID 2 запросил список чатов.
2025-05-29 22:54:54,922 - ServerApp - DEBUG - Для user_id 2 найдено 3 чатов.
2025-05-29 22:54:57,940 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "request_chat_history", "payload": {"chat_id": 1}}
2025-05-29 22:54:57,940 - ServerApp - INFO - User_id 2 запросил историю для чата ID 1.
2025-05-29 22:54:57,941 - ServerApp - DEBUG - Извлечено 25 сообщений для chat_id: 1
2025-05-29 22:55:00,638 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "send_message_to_chat", "payload": {"chat_id": 1, "text": "22234"}}
2025-05-29 22:55:00,638 - ServerApp - DEBUG - Попытка INSERT сообщения: chat_id=1, sender_id=2, content='22234...'
2025-05-29 22:55:00,639 - ServerApp - DEBUG - Сообщение вставлено, ID: 99, Время БД: 2025-05-29T22:55:00.638475+07:00
2025-05-29 22:55:00,639 - ServerApp - DEBUG - Попытка UPDATE chats: chat_id=1, last_message_at=2025-05-29T22:55:00.638475+07:00
2025-05-29 22:55:00,639 - ServerApp - INFO - Сообщение ID: 99 от user_id: 2 в chat_id: 1 сохранено, last_message_at обновлено (2025-05-29T22:55:00.638475+07:00).
2025-05-29 22:55:00,640 - ServerApp - INFO - Сообщение (ID: 99) от 2222 в чат 1 сохранено.
2025-05-29 22:55:00,640 - ServerApp - DEBUG - Участники чата 1 для рассылки (кроме 2 - 2222): [1]
2025-05-29 22:55:00,640 - ServerApp - INFO - Доставка сообщения (ID: 99) от 2222 участнику 1111 (ID: 1) чата 1.
2025-05-29 22:55:00,649 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:55:00,649 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:55:00,649 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:55:04,219 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "send_message_to_chat", "payload": {"chat_id": 1, "text": "111"}}
2025-05-29 22:55:04,220 - ServerApp - DEBUG - Попытка INSERT сообщения: chat_id=1, sender_id=2, content='111...'
2025-05-29 22:55:04,222 - ServerApp - DEBUG - Сообщение вставлено, ID: 100, Время БД: 2025-05-29T22:55:04.220022+07:00
2025-05-29 22:55:04,222 - ServerApp - DEBUG - Попытка UPDATE chats: chat_id=1, last_message_at=2025-05-29T22:55:04.220022+07:00
2025-05-29 22:55:04,223 - ServerApp - INFO - Сообщение ID: 100 от user_id: 2 в chat_id: 1 сохранено, last_message_at обновлено (2025-05-29T22:55:04.220022+07:00).
2025-05-29 22:55:04,223 - ServerApp - INFO - Сообщение (ID: 100) от 2222 в чат 1 сохранено.
2025-05-29 22:55:04,223 - ServerApp - DEBUG - Участники чата 1 для рассылки (кроме 2 - 2222): [1]
2025-05-29 22:55:04,223 - ServerApp - INFO - Доставка сообщения (ID: 100) от 2222 участнику 1111 (ID: 1) чата 1.
2025-05-29 22:55:12,417 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:55:12,417 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:55:12,418 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:55:12,428 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:55:12,428 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:55:12,429 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:55:14,457 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:55:14,457 - ServerApp - INFO - Пользователь ID 1 запросил список чатов.
2025-05-29 22:55:14,458 - ServerApp - DEBUG - Для user_id 1 найдено 6 чатов.
2025-05-29 22:55:15,827 - ServerApp - DEBUG - Получено от 1111 (('127.0.0.1', 53029)): {"type": "request_chat_history", "payload": {"chat_id": 1}}
2025-05-29 22:55:15,827 - ServerApp - INFO - User_id 1 запросил историю для чата ID 1.
2025-05-29 22:55:15,828 - ServerApp - DEBUG - Извлечено 27 сообщений для chat_id: 1
2025-05-29 22:55:19,970 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "request_chat_list", "payload": {}}
2025-05-29 22:55:19,970 - ServerApp - INFO - Пользователь ID 2 запросил список чатов.
2025-05-29 22:55:19,971 - ServerApp - DEBUG - Для user_id 2 найдено 3 чатов.
2025-05-29 22:55:21,124 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "request_chat_history", "payload": {"chat_id": 1}}
2025-05-29 22:55:21,124 - ServerApp - INFO - User_id 2 запросил историю для чата ID 1.
2025-05-29 22:55:21,125 - ServerApp - DEBUG - Извлечено 27 сообщений для chat_id: 1
2025-05-29 22:55:23,395 - ServerApp - DEBUG - Получено от 2222 (('127.0.0.1', 53031)): {"type": "send_message_to_chat", "payload": {"chat_id": 1, "text": "123"}}
2025-05-29 22:55:23,395 - ServerApp - DEBUG - Попытка INSERT сообщения: chat_id=1, sender_id=2, content='123...'
2025-05-29 22:55:23,396 - ServerApp - DEBUG - Сообщение вставлено, ID: 101, Время БД: 2025-05-29T22:55:23.395709+07:00
2025-05-29 22:55:23,396 - ServerApp - DEBUG - Попытка UPDATE chats: chat_id=1, last_message_at=2025-05-29T22:55:23.395709+07:00
2025-05-29 22:55:23,396 - ServerApp - INFO - Сообщение ID: 101 от user_id: 2 в chat_id: 1 сохранено, last_message_at обновлено (2025-05-29T22:55:23.395709+07:00).
2025-05-29 22:55:23,396 - ServerApp - INFO - Сообщение (ID: 101) от 2222 в чат 1 сохранено.
2025-05-29 22:55:23,396 - ServerApp - DEBUG - Участники чата 1 для рассылки (кроме 2 - 2222): [1]
2025-05-29 22:55:23,396 - ServerApp - INFO - Доставка сообщения (ID: 101) от 2222 участнику 1111 (ID: 1) чата 1.
2025-05-29 22:59:11,079 - ServerApp - INFO - Получен сигнал KeyboardInterrupt (Ctrl+C)...
2025-05-29 22:59:11,079 - ServerApp - INFO - Сервер останавливается...
2025-05-29 22:59:11,079 - ServerApp - INFO - Сервер полностью остановлен.
